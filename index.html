<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Directional Lines Bilingual (Leaflet)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea, input { width: 100%; margin-bottom: 10px; padding: 8px; }
    #map { height: 500px; margin-top: 20px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>Nhập thông tin / Enter Information</h2>
  <label for="point">Toạ độ (dạng bất kỳ):</label>
  <textarea id="point" rows="2" placeholder="Ví dụ: -25.9493454, 32.5620781"></textarea>

  <label for="name">Tên điểm / Point Name:</label>
  <textarea id="name" rows="2" placeholder="VD: MAC278"></textarea>

  <label for="length">Độ dài mỗi đường (m) / Line Length (m):</label>
  <textarea id="length" rows="1" placeholder="VD: 100"></textarea>

  <label for="angles">3 Góc (độ, cách nhau bởi dấu phẩy) / 3 Angles (degrees, comma-separated):</label>
  <textarea id="angles" rows="2" placeholder="VD: 60,180,300"></textarea>

  <button onclick="drawLines()">Vẽ đường / Draw Lines</button>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    let map;

    function parseCoordinate(input) {
      const cleaned = input.replace(/[(),]/g, ' ').trim().replace(/\s+/g, ' ');
      const parts = cleaned.split(' ');
      if (parts.length >= 2) {
        return { lat: parseFloat(parts[0]), lng: parseFloat(parts[1]) };
      }
      return null;
    }

    function drawLines() {
      const pointInput = document.getElementById("point").value;
      const point = parseCoordinate(pointInput);
      const name = document.getElementById("name").value;
      const length = parseFloat(document.getElementById("length").value);
      const angles = document.getElementById("angles").value.split(',').map(a => parseFloat(a.trim()));

      if (!point || angles.length !== 3 || isNaN(length)) {
        alert("Vui lòng nhập đúng định dạng. Please enter correct format.");
        return;
      }

      if (!map) {
        map = L.map('map').setView([point.lat, point.lng], 19);
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  attribution: 'Tiles © Esri'
}).addTo(map);
      } else {
        map.setView([point.lat, point.lng], 19);
        map.eachLayer((layer) => { if (layer instanceof L.Polyline || layer instanceof L.Marker) map.removeLayer(layer); });
      }

      L.marker([point.lat, point.lng]).addTo(map).bindPopup(name).openPopup();

      const colors = ['red', 'yellow', 'darkblue'];
      const R = 6378137;

      angles.forEach((angle, idx) => {
        const rad = angle * Math.PI / 180;
        const dx = length * Math.sin(rad);
        const dy = length * Math.cos(rad);

        const destLat = point.lat + (dy / R) * (180 / Math.PI);
        const destLng = point.lng + (dx / (R * Math.cos(point.lat * Math.PI / 180))) * (180 / Math.PI);

        L.polyline([
          [point.lat, point.lng],
          [destLat, destLng]
        ], {
          color: colors[idx],
          weight: 4
        }).addTo(map);
      });
    }
  </script>
</body>
</html>
